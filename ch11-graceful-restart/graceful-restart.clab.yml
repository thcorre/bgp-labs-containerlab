# =============================================================================
# Lab: Graceful Restart and Error Handling
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 11 - Graceful Restart and Error Handling
# =============================================================================
# This lab demonstrates:
# - BGP Graceful Restart mechanism
# - GR Helper mode
# - Long-Lived Graceful Restart (LLGR)
# - Notification support for GR
# - Error handling and treat-as-withdraw
# =============================================================================
#
# Topology:
#
#    CE1 ---- PE1 ---- P1 ---- PE2 ---- CE2
#              |               |
#              +------ P2 -----+
#
# PE1: Graceful Restart capable (restarter)
# PE2: GR Helper mode
# Multiple paths for redundancy during restart
# =============================================================================

name: ch11-graceful-restart

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.partial.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.partial.cfg
      
    P1:
      kind: nokia_srsim
      startup-config: configs/P1.partial.cfg
      
    P2:
      kind: nokia_srsim
      startup-config: configs/P2.partial.cfg
      
    CE1:
      kind: linux
      
    CE2:
      kind: linux

  links:
    # Primary path
    - endpoints: ["PE1:1/1/1", "P1:1/1/1"]
    - endpoints: ["P1:1/1/2", "PE2:1/1/1"]
    
    # Backup path
    - endpoints: ["PE1:1/1/3", "P2:1/1/1"]
    - endpoints: ["P2:1/1/2", "PE2:1/1/3"]
    
    # Cross-link
    - endpoints: ["P1:1/1/3", "P2:1/1/3"]
    
    # CE connections
    - endpoints: ["CE1:eth1", "PE1:1/1/2"]
    - endpoints: ["CE2:eth1", "PE2:1/1/2"]
