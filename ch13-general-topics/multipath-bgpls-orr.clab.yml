# =============================================================================
# Lab: BGP General Topics - Load Balancing and BGP-LS
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 13 - General Topics
# =============================================================================
# This lab demonstrates:
# - IBGP Multipath / ECMP
# - EBGP Multipath
# - Weighted ECMP
# - BGP-LS (Link State Distribution)
# - Optimal Route Reflection (ORR)
# - BGP Monitoring Protocol (BMP)
# - QoS Policy Propagation using BGP (QPPB)
# =============================================================================
#
# Topology:
#
#                        +---- PE2 ----+
#                       /               \
#    CE1 ---- PE1 ----+                  +---- PE4 ---- CE2
#                       \               /
#                        +---- PE3 ----+
#                              |
#                             RR (ORR enabled)
#                              |
#                        SDN Controller
#                        (BGP-LS consumer)
#
# Demonstrates multipath, ORR location-aware route selection,
# and BGP-LS export to SDN controller
# =============================================================================

name: ch13-general-topics

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    # Provider Edge Routers
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.cfg
      
    PE3:
      kind: nokia_srsim
      startup-config: configs/PE3.cfg
      
    PE4:
      kind: nokia_srsim
      startup-config: configs/PE4.cfg
      
    # Route Reflector with ORR
    RR:
      kind: nokia_srsim
      startup-config: configs/RR.cfg
      
    # SDN Controller (BGP-LS consumer)
    SDN-Controller:
      kind: linux
      
    # BMP Station
    BMP-Station:
      kind: linux
      
    # Customer Edge
    CE1:
      kind: nokia_srsim
      startup-config: configs/CE1.cfg
      
    CE2:
      kind: nokia_srsim
      startup-config: configs/CE2.cfg

  links:
    # Core mesh - multiple paths for ECMP
    - endpoints: ["PE1:1/1/1", "PE2:1/1/1"]
    - endpoints: ["PE1:1/1/2", "PE3:1/1/1"]
    - endpoints: ["PE2:1/1/2", "PE4:1/1/1"]
    - endpoints: ["PE3:1/1/2", "PE4:1/1/2"]
    - endpoints: ["PE2:1/1/3", "PE3:1/1/3"]
    
    # RR connections
    - endpoints: ["RR:1/1/1", "PE2:1/1/4"]
    - endpoints: ["RR:1/1/2", "PE3:1/1/4"]
    
    # SDN Controller and BMP
    - endpoints: ["RR:1/1/3", "SDN-Controller:eth1"]
    - endpoints: ["RR:1/1/4", "BMP-Station:eth1"]
    
    # CE connections
    - endpoints: ["PE1:1/1/3", "CE1:1/1/1"]
    - endpoints: ["PE4:1/1/3", "CE2:1/1/1"]
