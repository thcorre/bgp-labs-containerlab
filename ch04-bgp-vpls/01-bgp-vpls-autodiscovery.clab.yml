# =============================================================================
# Lab: BGP VPLS
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 4 - Using BGP in VPLS
# =============================================================================
# This lab demonstrates:
# - BGP Auto-Discovery with LDP Signalling
# - BGP Auto-Discovery and Signalling (RFC 4761)
# - VPLS Multi-Homing with BGP
# =============================================================================
#
# Topology:
#
#              +---- PE1 ----+
#             /               \
#    CE1 ----+     VPLS-100    +---- CE2
#             \               /
#              +---- PE2 ----+
#                    |
#                   RR
#                    |
#              +---- PE3 ----+
#             /               \
#    CE3 ----+                 +---- CE4
#             \               /
#              +---- PE4 ----+
#
# BGP VPLS with Route Target: 64496:100
# Multi-homed CEs for redundancy
# =============================================================================

name: ch04-bgp-vpls

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R1
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.cfg
      
    PE3:
      kind: nokia_srsim
      startup-config: configs/PE3.cfg
      
    PE4:
      kind: nokia_srsim
      startup-config: configs/PE4.cfg
      
    RR:
      kind: nokia_srsim
      startup-config: configs/RR.cfg
      
    CE1:
      kind: linux
      
    CE2:
      kind: linux
      
    CE3:
      kind: linux
      
    CE4:
      kind: linux

  links:
    # Core mesh
    - endpoints: ["PE1:1/1/1", "RR:1/1/1"]
    - endpoints: ["PE2:1/1/1", "RR:1/1/2"]
    - endpoints: ["PE3:1/1/1", "RR:1/1/3"]
    - endpoints: ["PE4:1/1/1", "RR:1/1/4"]
    
    # Multi-homed CE1
    - endpoints: ["CE1:eth1", "PE1:1/1/2"]
    - endpoints: ["CE1:eth2", "PE2:1/1/2"]
    
    # Single-homed CE2
    - endpoints: ["CE2:eth1", "PE1:1/1/3"]
    
    # Multi-homed CE3
    - endpoints: ["CE3:eth1", "PE3:1/1/2"]
    - endpoints: ["CE3:eth2", "PE4:1/1/2"]
    
    # Single-homed CE4
    - endpoints: ["CE4:eth1", "PE3:1/1/3"]
