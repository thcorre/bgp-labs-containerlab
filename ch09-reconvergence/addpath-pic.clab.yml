# =============================================================================
# Lab: BGP Reconvergence - ADD-PATH and PIC
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 9 - Reconvergence
# =============================================================================
# This lab demonstrates:
# - ADD-PATH (Advertisement of Multiple Paths)
# - Best External
# - Prefix Independent Convergence (PIC) Core and Edge
# - Next-Hop Tracking
# - Minimum Route Advertisement Interval (MRAI)
# - Rapid Withdrawal
# =============================================================================
#
# Topology:
#
#           AS 64510                    AS 64496                    AS 64520
#    +----------------+    +---------------------------+    +----------------+
#    |                |    |                           |    |                |
#    |    External1 --+----+-- PE1 -------- RR ------- PE2 --+-- External2   |
#    |        |       |    |      \       /       \    |    |        |       |
#    |    External3 --+----+-- PE3 ----+----------PE4 --+----+-- External4   |
#    |                |    |                           |    |                |
#    +----------------+    +---------------------------+    +----------------+
#
# Multiple paths to demonstrate ADD-PATH and fast failover
# =============================================================================

name: ch09-reconvergence

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt

  nodes:
    # Provider Edge Routers
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.cfg
      
    PE3:
      kind: nokia_srsim
      startup-config: configs/PE3.cfg
      
    PE4:
      kind: nokia_srsim
      startup-config: configs/PE4.cfg
      
    # Route Reflector
    RR:
      kind: nokia_srsim
      startup-config: configs/RR.cfg
      
    # External peers (AS 64510)
    External1:
      kind: nokia_srsim
      startup-config: configs/External1.cfg
      
    External3:
      kind: nokia_srsim
      startup-config: configs/External3.cfg
      
    # External peers (AS 64520)
    External2:
      kind: nokia_srsim
      startup-config: configs/External2.cfg
      
    External4:
      kind: nokia_srsim
      startup-config: configs/External4.cfg

  links:
    # Core mesh
    - endpoints: ["PE1:1/1/1", "RR:1/1/1"]
    - endpoints: ["PE2:1/1/1", "RR:1/1/2"]
    - endpoints: ["PE3:1/1/1", "RR:1/1/3"]
    - endpoints: ["PE4:1/1/1", "RR:1/1/4"]
    - endpoints: ["PE1:1/1/3", "PE3:1/1/3"]
    - endpoints: ["PE2:1/1/3", "PE4:1/1/3"]
    
    # EBGP links to AS 64510
    - endpoints: ["PE1:1/1/2", "External1:1/1/1"]
    - endpoints: ["PE3:1/1/2", "External3:1/1/1"]
    
    # EBGP links to AS 64520
    - endpoints: ["PE2:1/1/2", "External2:1/1/1"]
    - endpoints: ["PE4:1/1/2", "External4:1/1/1"]
