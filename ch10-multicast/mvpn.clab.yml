# =============================================================================
# Lab: Multicast with BGP - MVPN
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 10 - Multicast
# =============================================================================
# This lab demonstrates:
# - Multicast VPN (MVPN) with BGP signalling
# - MVPN Route Types (1-7)
# - Draft-Rosen multicast VPN
# - P-tunnels (Inclusive and Selective)
# - Wildcard S-PMSI
# =============================================================================
#
# Topology:
#
#    Source --- CE1 ---- PE1 ---- P1 ---- PE2 ---- CE2 --- Receiver
#                         |               |
#                         +---- P2 -------+
#                               |
#                              PE3 ---- CE3 --- Receiver
#
# Multicast VPN: RT 64496:100
# P-tunnel: mLDP or RSVP-TE
# =============================================================================

name: ch10-multicast-mvpn

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.cfg
      
    PE3:
      kind: nokia_srsim
      startup-config: configs/PE3.cfg
      
    P1:
      kind: nokia_srsim
      startup-config: configs/P1.cfg
      
    P2:
      kind: nokia_srsim
      startup-config: configs/P2.cfg
      
    CE1:
      kind: linux
      
    CE2:
      kind: linux
      
    CE3:
      kind: linux

  links:
    # Core mesh
    - endpoints: ["PE1:1/1/1", "P1:1/1/1"]
    - endpoints: ["PE2:1/1/1", "P1:1/1/2"]
    - endpoints: ["PE1:1/1/3", "P2:1/1/1"]
    - endpoints: ["PE2:1/1/3", "P2:1/1/2"]
    - endpoints: ["PE3:1/1/1", "P2:1/1/3"]
    - endpoints: ["P1:1/1/3", "P2:1/1/4"]
    
    # CE connections
    - endpoints: ["CE1:eth1", "PE1:1/1/2"]  # Source
    - endpoints: ["CE2:eth1", "PE2:1/1/2"]  # Receiver
    - endpoints: ["CE3:eth1", "PE3:1/1/2"]  # Receiver
