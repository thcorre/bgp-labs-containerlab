# =============================================================================
# Lab: BGP Signalling for VPWS
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 5 - BGP Signalling for VPWS
# =============================================================================
# This lab demonstrates:
# - Single-homed VPWS with BGP signalling
# - Multi-homed VPWS (Active/Standby)
# - Pseudowire redundancy
# =============================================================================
#
# Topology:
#
#    CE1 ==== R1 --------------- R2 ==== CE2
#              \                 /
#               \               /
#                \-- RR1 ------/
#               /               \
#              /                 \
#    CE3 ==== R3 --------------- R4 ==== CE4
#
# VPWS-1: CE1 <-> CE2 (single-homed)
# VPWS-2: CE3 <-> CE4 (multi-homed active/standby)
# =============================================================================

name: ch05-bgp-vpws

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    R1:
      kind: nokia_srsim
      startup-config: configs/R1.partial.cfg
      
    R2:
      kind: nokia_srsim
      startup-config: configs/R2.partial.cfg
      
    R3:
      kind: nokia_srsim
      startup-config: configs/R3.partial.cfg
      
    R4:
      kind: nokia_srsim
      startup-config: configs/R4.partial.cfg
      
    RR1:
      kind: nokia_srsim
      startup-config: configs/RR1.partial.cfg
      
    CE1:
      kind: linux
      
    CE2:
      kind: linux
      
    CE3:
      kind: linux
      
    CE4:
      kind: linux

  links:
    # Core mesh
    - endpoints: ["R1:1/1/1", "RR1:1/1/1"]
    - endpoints: ["R2:1/1/1", "RR1:1/1/2"]
    - endpoints: ["R3:1/1/1", "RR1:1/1/3"]
    - endpoints: ["R4:1/1/1", "RR1:1/1/4"]
    - endpoints: ["R1:1/1/3", "R2:1/1/3"]
    - endpoints: ["R3:1/1/3", "R4:1/1/3"]
    
    # VPWS-1: Single-homed
    - endpoints: ["CE1:eth1", "R1:1/1/2"]
    - endpoints: ["CE2:eth1", "R2:1/1/2"]
    
    # VPWS-2: Multi-homed (CE3 dual-homed)
    - endpoints: ["CE3:eth1", "R3:1/1/2"]
    - endpoints: ["CE3:eth2", "R1:1/1/4"]
    - endpoints: ["CE4:eth1", "R4:1/1/2"]
