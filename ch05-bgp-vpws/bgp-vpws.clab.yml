# =============================================================================
# Lab: BGP Signalling for VPWS
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 5 - BGP Signalling for VPWS
# =============================================================================
# This lab demonstrates:
# - Single-homed VPWS with BGP signalling
# - Multi-homed VPWS (Active/Standby)
# - Pseudowire redundancy
# =============================================================================
#
# Topology:
#
#    CE1 ==== PE1 --------------- PE2 ==== CE2
#              \                 /
#               \               /
#                \-- RR ------/
#               /               \
#              /                 \
#    CE3 ==== PE3 --------------- PE4 ==== CE4
#
# VPWS-1: CE1 <-> CE2 (single-homed)
# VPWS-2: CE3 <-> CE4 (multi-homed active/standby)
# =============================================================================

name: ch05-bgp-vpws

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.cfg
      
    PE3:
      kind: nokia_srsim
      startup-config: configs/PE3.cfg
      
    PE4:
      kind: nokia_srsim
      startup-config: configs/PE4.cfg
      
    RR:
      kind: nokia_srsim
      startup-config: configs/RR.cfg
      
    CE1:
      kind: linux
      
    CE2:
      kind: linux
      
    CE3:
      kind: linux
      
    CE4:
      kind: linux

  links:
    # Core mesh
    - endpoints: ["PE1:1/1/1", "RR:1/1/1"]
    - endpoints: ["PE2:1/1/1", "RR:1/1/2"]
    - endpoints: ["PE3:1/1/1", "RR:1/1/3"]
    - endpoints: ["PE4:1/1/1", "RR:1/1/4"]
    - endpoints: ["PE1:1/1/3", "PE2:1/1/3"]
    - endpoints: ["PE3:1/1/3", "PE4:1/1/3"]
    
    # VPWS-1: Single-homed
    - endpoints: ["CE1:eth1", "PE1:1/1/2"]
    - endpoints: ["CE2:eth1", "PE2:1/1/2"]
    
    # VPWS-2: Multi-homed (CE3 dual-homed)
    - endpoints: ["CE3:eth1", "PE3:1/1/2"]
    - endpoints: ["CE3:eth2", "PE1:1/1/4"]
    - endpoints: ["CE4:eth1", "PE4:1/1/2"]
