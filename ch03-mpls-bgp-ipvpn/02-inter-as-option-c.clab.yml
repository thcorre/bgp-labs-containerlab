# =============================================================================
# Lab: Inter-AS Option C
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 3 - MPLS/BGP IP-VPNs (Multi-AS Backbones)
# =============================================================================
# This lab demonstrates:
# - Inter-AS Option C (RFC 4364 Section 10c)
# - EBGP labeled unicast between ASBRs
# - VPNv4 route exchange via Inter-AS RRs
# - Multi-hop EBGP for VPNv4
# =============================================================================
#
# Topology:
#
#    AS 64496                                        AS 64510
#    +---------------------------+                  +---------------------------+
#    |                           |                  |                           |
#    | CE1---PE1---P1---ASBR1 ---+--- EBGP-LU ---+--- ASBR2---P2---PE2---CE2   |
#    |        |         |        |                  |        |         |        |
#    |        +-- RR1 --+        |                  |        +-- RR2 --+        |
#    |                           |                  |                           |
#    +---------------------------+                  +---------------------------+
#                                      
#                          VPNv4 via Multi-hop EBGP
#                              RR1 <-----> RR2
#
# =============================================================================

name: ch03-inter-as-option-c

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    # AS 64496
    PE1:
      kind: nokia_srsim
      startup-config: configs/inter-as/PE1.partial.cfg
      
    P1:
      kind: nokia_srsim
      startup-config: configs/inter-as/P1.partial.cfg
      
    RR1:
      kind: nokia_srsim
      startup-config: configs/inter-as/RR1.partial.cfg
      
    ASBR1:
      kind: nokia_srsim
      startup-config: configs/inter-as/ASBR1.partial.cfg
      
    # AS 64510
    ASBR2:
      kind: nokia_srsim
      startup-config: configs/inter-as/ASBR2.partial.cfg
      
    P2:
      kind: nokia_srsim
      startup-config: configs/inter-as/P2.partial.cfg
      
    RR2:
      kind: nokia_srsim
      startup-config: configs/inter-as/RR2.partial.cfg
      
    PE2:
      kind: nokia_srsim
      startup-config: configs/inter-as/PE2.partial.cfg
      
    # Customer Edge
    CE1:
      kind: linux
      
    CE2:
      kind: linux

  links:
    # AS 64496 internal
    - endpoints: ["PE1:1/1/1", "P1:1/1/1"]
    - endpoints: ["P1:1/1/2", "ASBR1:1/1/1"]
    - endpoints: ["P1:1/1/3", "RR1:1/1/1"]
    - endpoints: ["PE1:1/1/3", "RR1:1/1/2"]
    
    # Inter-AS link (EBGP labeled unicast)
    - endpoints: ["ASBR1:1/1/2", "ASBR2:1/1/1"]
    
    # AS 64510 internal
    - endpoints: ["ASBR2:1/1/2", "P2:1/1/1"]
    - endpoints: ["P2:1/1/2", "PE2:1/1/1"]
    - endpoints: ["P2:1/1/3", "RR2:1/1/1"]
    - endpoints: ["PE2:1/1/3", "RR2:1/1/2"]
    
    # CE connections
    - endpoints: ["CE1:eth1", "PE1:1/1/2"]
    - endpoints: ["CE2:eth1", "PE2:1/1/2"]
