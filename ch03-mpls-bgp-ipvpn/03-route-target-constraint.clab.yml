# =============================================================================
# Lab: Route Target Constraint (RTC)
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 3 - MPLS/BGP IP-VPNs (Prefix Dissemination)
# =============================================================================
# This lab demonstrates:
# - Route Target Constraint (RFC 4684)
# - Automatic Route Filtering
# - Reduced VPNv4 table size on PEs
# - RTC advertisement to Route Reflectors
# =============================================================================
#
# Topology (Figure 3-7 from book):
#
#                                  AS 64496
#
#              RR1              IBGP non-client                RR2
#           192.0.2.10 ----------------------------------- 192.0.2.11
#            /       \                                     /       \
#    IBGP   /         \  IBGP                       IBGP  /         \  IBGP
#   client /           \ client                    client/           \ client
#         /             \                               /             \
#        R1             R4                            R6              R3
#     192.0.2.1      192.0.2.4                    192.0.2.6       192.0.2.3
#
# RT 64496:1                                                    RT 64496:1
# 172.31.1.0/24                                                 172.31.3.0/24
#                                                               RT 64496:2
#                                                               192.168.100.0/24
#
# R1:  VPN with RT 64496:1 (172.31.1.0/24)
# R3:  VPN with RT 64496:1 (172.31.3.0/24) and RT 64496:2 (192.168.100.0/24)
# R4:  No VPN services
# R6:  No VPN services
# RR1: Route Reflector for R1, R4
# RR2: Route Reflector for R6, R3
# =============================================================================

name: ch03-route-target-constraint

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt

  nodes:
    # AS 64496
    R1:
      kind: nokia_srsim
      startup-config: configs/03/R1.partial.cfg
      
    R4:
      kind: nokia_srsim
      startup-config: configs/03/R4.partial.cfg

    R3:
      kind: nokia_srsim
      startup-config: configs/03/R3.partial.cfg
      
    R6:
      kind: nokia_srsim
      startup-config: configs/03/R6.partial.cfg

    RR1:
      kind: nokia_srsim
      startup-config: configs/03/RR1.partial.cfg

    RR2:
      kind: nokia_srsim
      startup-config: configs/03/RR2.partial.cfg

  links:
    - endpoints: ["R1:1/1/c1/1", "RR1:1/1/c2/1"]
    - endpoints: ["R4:1/1/c1/1", "RR1:1/1/c3/1"]
    - endpoints: ["RR1:1/1/c1/1", "RR2:1/1/c1/1"]
    - endpoints: ["R3:1/1/c1/1", "RR2:1/1/c2/1"]
    - endpoints: ["R6:1/1/c1/1", "RR2:1/1/c3/1"]
