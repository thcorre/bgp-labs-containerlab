# =============================================================================
# Lab: BGP Security - FlowSpec and RTBH
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 12 - Security
# =============================================================================
# This lab demonstrates:
# - FlowSpec for DDoS mitigation
# - Remote Triggered Black-Holing (RTBH)
# - Generalized TTL Security Mechanism (GTSM)
# - TCP-AO (Authentication Option)
# - Prefix Origin Validation (RPKI)
# - Auto-generation of filters for BGP peers
# =============================================================================
#
# Topology:
#
#    Attacker                  Customer Network
#       |                           |
#    Internet ---- PE1 ---- P1 ---- PE2 ---- Server Farm
#                   |               |
#                   +---- FlowSpec --+
#                        Controller
#
# FlowSpec Controller: Injects flow rules to block attacks
# RTBH: Customer can trigger black-hole for attacked prefixes
# =============================================================================

name: ch12-security-flowspec

topology:
  kinds:
    nokia_srsim:
      image: nokia_srsim:25.10.R2
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    # Provider Edge - Internet facing
    PE1:
      kind: nokia_srsim
      startup-config: configs/PE1.partial.cfg
      
    # Provider Core
    P1:
      kind: nokia_srsim
      startup-config: configs/P1.partial.cfg
      
    # Provider Edge - Customer facing
    PE2:
      kind: nokia_srsim
      startup-config: configs/PE2.partial.cfg
      
    # FlowSpec Controller
    FlowSpec-Controller:
      kind: nokia_srsim
      startup-config: configs/FlowSpec-Controller.partial.cfg
      
    # Internet/Attacker simulation
    Internet:
      kind: nokia_srsim
      startup-config: configs/Internet.partial.cfg
      
    # Customer/Target
    Customer:
      kind: linux

  links:
    # Core links
    - endpoints: ["PE1:1/1/1", "P1:1/1/1"]
    - endpoints: ["PE2:1/1/1", "P1:1/1/2"]
    
    # FlowSpec Controller connections
    - endpoints: ["FlowSpec-Controller:1/1/1", "P1:1/1/3"]
    
    # Internet facing
    - endpoints: ["PE1:1/1/2", "Internet:1/1/1"]
    
    # Customer facing
    - endpoints: ["PE2:1/1/2", "Customer:eth1"]
