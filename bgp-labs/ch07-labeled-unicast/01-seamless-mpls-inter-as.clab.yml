# =============================================================================
# Lab: Labeled Unicast IPv4 - Seamless MPLS & Inter-AS
# Book: Versatile Routing and Services with BGP - Volume II
# Chapter: 7 - Labeled Unicast IPv4
# =============================================================================
# This lab demonstrates:
# - Seamless MPLS (multi-area MPLS with BGP-LU)
# - Inter-AS Option C
# - BGP-LDP FEC Stitching
# - Carriers Carrier
# - 6PE (IPv6 PE)
# =============================================================================
#
# Topology:
#
#    AS 64496 (Area 1)     AS 64496 (Core)     AS 64496 (Area 2)
#    +----------------+    +---------------+    +----------------+
#    |                |    |               |    |                |
#    |  PE1 --- ABR1 -+----+- P1 --- P2 ---+----+- ABR2 --- PE2  |
#    |                |    |               |    |                |
#    +----------------+    +---------------+    +----------------+
#           |                                          |
#          CE1                                        CE2
#
#    Inter-AS Option C Extension:
#
#    AS 64496                              AS 64510
#    +------------------+    EBGP-LU     +------------------+
#    |  ...ABR2 --- ASBR1 --------+------- ASBR2 --- PE3   |
#    +------------------+                +------------------+
#                                              |
#                                             CE3
#
# Seamless MPLS: End-to-end LSP via BGP labeled unicast
# Inter-AS Option C: EBGP for labeled IPv4 between ASes
# =============================================================================

name: ch07-labeled-unicast

topology:
  kinds:
    nokia_sros:
      image: nokia_srsim:25.7.R1
      type: sr-1
      license: /opt/nokia/sros/license.txt
    linux:
      image: ghcr.io/hellt/network-multitool:latest

  nodes:
    # AS 64496 - Area 1
    PE1:
      kind: nokia_sros
      startup-config: configs/PE1.cfg
      
    ABR1:
      kind: nokia_sros
      startup-config: configs/ABR1.cfg
      
    # AS 64496 - Core
    P1:
      kind: nokia_sros
      startup-config: configs/P1.cfg
      
    P2:
      kind: nokia_sros
      startup-config: configs/P2.cfg
      
    # AS 64496 - Area 2
    ABR2:
      kind: nokia_sros
      startup-config: configs/ABR2.cfg
      
    PE2:
      kind: nokia_sros
      startup-config: configs/PE2.cfg
      
    # Inter-AS (AS 64496 side)
    ASBR1:
      kind: nokia_sros
      startup-config: configs/ASBR1.cfg
      
    # AS 64510
    ASBR2:
      kind: nokia_sros
      startup-config: configs/ASBR2.cfg
      
    PE3:
      kind: nokia_sros
      startup-config: configs/PE3.cfg
      
    # Customer Edge
    CE1:
      kind: linux
      
    CE2:
      kind: linux
      
    CE3:
      kind: linux

  links:
    # Area 1 links
    - endpoints: ["PE1:1/1/1", "ABR1:1/1/1"]
    
    # Core links
    - endpoints: ["ABR1:1/1/2", "P1:1/1/1"]
    - endpoints: ["P1:1/1/2", "P2:1/1/1"]
    - endpoints: ["P2:1/1/2", "ABR2:1/1/1"]
    
    # Area 2 links
    - endpoints: ["ABR2:1/1/2", "PE2:1/1/1"]
    
    # Inter-AS links
    - endpoints: ["ABR2:1/1/3", "ASBR1:1/1/1"]
    - endpoints: ["ASBR1:1/1/2", "ASBR2:1/1/1"]  # EBGP-LU link
    - endpoints: ["ASBR2:1/1/2", "PE3:1/1/1"]
    
    # CE connections
    - endpoints: ["PE1:1/1/2", "CE1:eth1"]
    - endpoints: ["PE2:1/1/2", "CE2:eth1"]
    - endpoints: ["PE3:1/1/2", "CE3:eth1"]
